<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>294 Manuten√ß√£o</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      background-color: #1e1e1e;
      color: #f8f9fa;
      font-family: monospace;
    }
    .terminal {
      background-color: #2a2a2a;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #444;
    }
    #tabela-registros {
      width: 100%;
      font-size: 0.9rem;
      color: #f8f9fa;
    }
    #tabela-registros th,
    #tabela-registros td {
      padding: 4px 8px;
      border-bottom: 1px solid #444;
      white-space: nowrap;
    }
    #tabela-registros thead th {
      position: sticky;
      top: 0;
      background-color: #333;
      z-index: 1;
    }
    .linha-selecionada {
      background-color: #555 !important;
    }
    .input-row {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #1e1e1e;
      padding: 0.5rem;
      border-top: 1px solid #444;
      z-index: 1000;
    }
    .input-row input {
      font-family: monospace;
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <h4 class="text-center mt-2">294 Manuten√ß√£o</h4>

    <input type="text" id="pesquisa" class="form-control form-control-sm mb-2" placeholder="üîé Pesquisar Motorista ou Observa√ß√µes" oninput="atualizarTabela()" />

    <div class="terminal">
      <table id="tabela-registros" class="table table-sm">
        <thead>
          <tr>
            <th>#</th>
            <th>Data</th>
            <th>H. Sa√≠da</th>
            <th>H. Entrada</th>
            <th>Km. Sa√≠da</th>
            <th>Km. Entrada</th>
            <th>Motorista</th>
            <th>Observa√ß√µes</th>
          </tr>
        </thead>
        <tbody id="corpo-registros"></tbody>
      </table>
    </div>

    <div class="input-row row gx-2">
      <div class="col"><input type="date" id="data" class="form-control form-control-sm" placeholder="Data"></div>
      <div class="col"><input type="time" id="saida" class="form-control form-control-sm" placeholder="H. Sa√≠da"></div>
      <div class="col"><input type="time" id="entrada" class="form-control form-control-sm" placeholder="H. Entrada"></div>
      <div class="col"><input type="number" id="km_saida" class="form-control form-control-sm" placeholder="Km. Sa√≠da"></div>
      <div class="col"><input type="number" id="km_entrada" class="form-control form-control-sm" placeholder="Km. Entrada"></div>
      <div class="col"><input type="text" id="motorista" class="form-control form-control-sm" placeholder="Motorista"></div>
      <div class="col"><input type="text" id="obs" class="form-control form-control-sm" placeholder="Observa√ß√µes"></div>
      <div class="col-auto d-grid">
        <button class="btn btn-success btn-sm" onclick="salvarRegistro()">Salvar</button>
      </div>
      <div class="col-auto d-grid">
        <button class="btn btn-warning btn-sm" onclick="editarRegistro()">Editar</button>
      </div>
      <div class="col-auto d-grid">
        <button class="btn btn-danger btn-sm" onclick="excluirRegistro()">Excluir</button>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'registros_294_manutencao';
    let registros = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    let registroSelecionado = null;

    function atualizarTabela() {
      const filtro = document.getElementById('pesquisa').value.toLowerCase();
      const corpo = document.getElementById('corpo-registros');

      corpo.innerHTML = registros
        .map((r, i) => ({ ...r, index: i }))
        .filter(r =>
          r.motorista.toLowerCase().includes(filtro) || r.obs.toLowerCase().includes(filtro)
        )
        .map(r => `
          <tr onclick="selecionarRegistro(${r.index})" class="${registroSelecionado === r.index ? 'linha-selecionada' : ''}">
            <td>${r.index + 1}</td>
            <td>${r.data}</td>
            <td>${r.saida}</td>
            <td>${r.entrada}</td>
            <td>${r.km_saida}</td>
            <td>${r.km_entrada}</td>
            <td>${r.motorista}</td>
            <td>${r.obs}</td>
          </tr>
        `).join('');
    }

    function salvarRegistro() {
      const novo = {
        data: document.getElementById('data').value,
        saida: document.getElementById('saida').value,
        entrada: document.getElementById('entrada').value,
        km_saida: document.getElementById('km_saida').value,
        km_entrada: document.getElementById('km_entrada').value,
        motorista: document.getElementById('motorista').value.trim(),
        obs: document.getElementById('obs').value.trim()
      };

      registros.push(novo);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(registros));
      limparCampos();
      atualizarTabela();
    }

    function selecionarRegistro(index) {
      const r = registros[index];
      registroSelecionado = index;
      document.getElementById('data').value = r.data;
      document.getElementById('saida').value = r.saida;
      document.getElementById('entrada').value = r.entrada;
      document.getElementById('km_saida').value = r.km_saida;
      document.getElementById('km_entrada').value = r.km_entrada;
      document.getElementById('motorista').value = r.motorista;
      document.getElementById('obs').value = r.obs;
      atualizarTabela();
    }

    function editarRegistro() {
      if (registroSelecionado === null) {
        alert("Selecione um registro para editar.");
        return;
      }

      registros[registroSelecionado] = {
        data: document.getElementById('data').value,
        saida: document.getElementById('saida').value,
        entrada: document.getElementById('entrada').value,
        km_saida: document.getElementById('km_saida').value,
        km_entrada: document.getElementById('km_entrada').value,
        motorista: document.getElementById('motorista').value.trim(),
        obs: document.getElementById('obs').value.trim()
      };

      localStorage.setItem(STORAGE_KEY, JSON.stringify(registros));
      atualizarTabela();
    }

    function excluirRegistro() {
      if (registroSelecionado === null) {
        alert("Selecione um registro para excluir.");
        return;
      }

      if (confirm(`Deseja excluir o registro #${registroSelecionado + 1}?`)) {
        registros.splice(registroSelecionado, 1);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(registros));
        limparCampos();
        atualizarTabela();
      }
    }

    function limparCampos() {
      document.querySelectorAll('.input-row input').forEach(i => i.value = '');
      registroSelecionado = null;
    }

    atualizarTabela();
  </script>
</body>
</html>

